# SyncFromGit (吉他库库) 插件技术说明

## 项目概述

SyncFromGit是一个Obsidian插件，用于通过Git实现笔记库的同步功能，支持多设备间的笔记同步。

## 技术栈

### 前端框架
- **Obsidian API**: 使用Obsidian插件API构建
- **TypeScript**: 提供类型安全的开发体验
- **Node.js**: 提供底层API访问（spawn、path、os、fs等）

### 构建工具
- **esbuild**: 快速的JavaScript打包工具
- **TypeScript Compiler (tsc)**: 类型检查和转译

### Git集成
- **Node.js Child Process API**: 执行本地Git命令
- **Git命令行工具**: 实际的版本控制操作

## 项目结构

```
sync-from-git/
├── src/
│   └── main.ts              # 插件主入口文件
├── manifest.json            # 插件元数据
├── package.json             # 项目依赖配置
├── tsconfig.json            # TypeScript配置
├── esbuild.config.mjs       # 构建配置文件
├── versions.json            # 版本发布跟踪
└── README.md                # 项目说明文档
```

## 核心功能实现

### 1. Git操作封装
- 使用`spawn`执行Git命令
- 封装常用Git操作（init、add、commit、pull、push、ls-remote等）
- 错误处理和输出解析

### 2. 文件系统集成
- 通过`FileSystemAdapter`获取Vault路径
- 处理文件和文件夹的相对路径计算
- 支持单个文件和整个目录的同步

### 3. 用户界面
- **右键菜单**: 添加"提交GIT库"选项
- **Ribbon图标**: 提供一键同步功能
- **设置面板**: 配置Git URL、自动同步等
- **分支选择对话框**: 用于选择远程分支

### 4. 同步逻辑
- 检查本地是否为Git仓库
- 初始化Git仓库和配置远程地址
- 自动执行拉取、提交、推送操作
- 支持按Obsidian仓库名称作为Git分支名

## 代码架构

### 主类：SyncFromGit
- 继承自`Plugin`类
- 管理所有插件功能的生命周期
- 处理设置数据的加载和保存

### 设置面板：SyncFromGitSettingTab
- 继承自`PluginSettingTab`
- 提供用户配置界面
- 包含URL输入、自动同步开关、同步按钮等

### 分支选择对话框：BranchSelectionModal
- 继承自`Modal`
- 显示远程分支列表供用户选择

## 关键实现要点

### 1. Git命令执行
```typescript
private async executeGitCommand(args: string[]): Promise<string>
```
- 使用Node.js子进程API执行Git命令
- 捕获标准输出和错误输出
- 根据返回码判断命令执行结果

### 2. 分支命名策略
- 使用Obsidian仓库名称作为Git分支名
- 清理特殊字符，转换为有效的Git分支名
- 默认分支名为'main'

### 3. 安全考虑
- 所有文件路径操作都经过验证
- 防止命令注入的安全措施
- 用户需要自行负责Git仓库的安全性

### 4. 错误处理
- Git操作的异常捕获和用户提示
- 详细的错误日志记录
- 优雅降级机制

## 构建和部署

### 开发构建
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```

### 发布流程
1. 更新版本号
2. 构建插件
3. 更新manifest.json中的版本号
4. 上传dist/main.js到发布平台
5. 更新versions.json中的版本映射

## 维护建议

### 依赖更新
- 定期更新Obsidian API依赖
- 检查TypeScript版本兼容性
- 测试Git命令在不同操作系统下的表现

### 功能扩展
- 考虑支持SSH认证
- 增加更细粒度的同步控制
- 支持自定义Git配置

### 兼容性
- 测试在不同操作系统上的兼容性
- 确保与Obsidian新版本的兼容性
- 验证各种Git服务器的兼容性

## 已知限制

1. 依赖本地Git安装
2. 仅支持桌面版Obsidian
3. 用户需要自行配置Git认证
4. 不支持Git LFS或其他高级Git功能